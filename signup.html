<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up - NetFlixX</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />

  <!-- ✅ Amplitude -->
  <script src="https://cdn.amplitude.com/script/ade7e539f08196c7af9b49113c377ba3.js"></script>
  <script>
    window.amplitude.add(window.sessionReplay.plugin({ sampleRate: 1 }));
    window.amplitude.init('ade7e539f08196c7af9b49113c377ba3', {
      fetchRemoteConfig: true,
      autocapture: true
    });
  </script>

  <!-- ✅ Mixpanel -->
  <script type="text/javascript">
    (function(f,b){
      if(!b.__SV){
        var a,e,i,g;window.mixpanel=b;b._i=[];
        b.init=function(a,e,d){
          function f(b,h){
            var a=h.split(".");
            2==a.length&&(b=b[a[0]],h=a[1]);
            b[h]=function(){
              b.push([h].concat(Array.prototype.slice.call(arguments,0)))
            }
          }
          var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";
          c.people=c.people||[];
          c.toString=function(b){
            var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a
          };
          c.people.toString=function(){
            return c.toString(1)+".people (stub)"
          };
          i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
          for(g=0;g<i.length;g++)f(c,i[g]);
          b._i.push([a,e,d])
        };
        b.__SV=1.2;
        a=f.createElement("script");
        a.type="text/javascript";
        a.async=!0;
        a.src="https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";
        e=f.getElementsByTagName("script")[0];
        e.parentNode.insertBefore(a,e)
      }
    })(document,window.mixpanel||[]);
    mixpanel.init("3d7cfe3bafbda9c8c1450f6972c1cb8f");
  </script>

  <script src="https://ts-script.app.thrivestack.ai/latest/thrivestack.js" 
    api-key="m9S/wwTPiv7egZcG7DeBdvlsW37YfHRMpstb3xh1S0g=" 
    source="marketing,product">
  </script>
  
</head>

<body>
  <nav class="navbar">
    <div class="logo"><a href="index.html" style="color:#e50914; text-decoration:none;">NetFlixX</a></div>
  </nav>

  <section class="section login-section">
    <h2>Sign Up</h2>
    <form class="auth-form" id="signupForm">
      <input type="email" placeholder="Email" id="signupEmail" required />
      <input type="password" placeholder="Password" id="signupPassword" required />
      <button type="submit" class="btn-auth">Sign Up</button>
      <p class="signup-link">Already have an account? <a href="index.html#login-signup">Login</a></p>
    </form>
  </section>

  <footer class="footer">
    <p>&copy; 2024 NetFlixX. All rights reserved.</p>
  </footer>

  <!-- ✅ Signup Tracking Logic -->
  <script>
    // Signup logic
    const signupForm = document.getElementById('signupForm');
    if (signupForm) {
      signupForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        // Optionally collect user name if you have a field for it
        const userName = '';
        sessionStorage.setItem('signupEmail', email);
        sessionStorage.setItem('signupPassword', password);
        // UTM params
        function getUTMParams() {
          const params = new URLSearchParams(window.location.search);
          return {
            utm_source: params.get('utm_source'),
            utm_medium: params.get('utm_medium'),
            utm_campaign: params.get('utm_campaign'),
            utm_term: params.get('utm_term')
          };
        }
        const utms = getUTMParams();
        // Generate or retrieve a user_id
        let userIdKey = `user_id_${email}`;
        let userId = localStorage.getItem(userIdKey);
        if (!userId) {
          userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
          localStorage.setItem(userIdKey, userId);
        }
        // Generate or retrieve an account_id (simulate for demo)
        let accountIdKey = `account_id_${email}`;
        let accountId = localStorage.getItem(accountIdKey);
        if (!accountId) {
          accountId = 'acc_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
          localStorage.setItem(accountIdKey, accountId);
        }
        // Extract domain from email
        const accountDomain = email.split('@')[1] || '';
        // Simulate account name from domain (or use a field if you have one)
        const accountName = accountDomain.split('.')[0].charAt(0).toUpperCase() + accountDomain.split('.')[0].slice(1);
        // ThriveStack batch event for signed_up
        if (typeof thriveStack !== 'undefined' && typeof window.thriveStack.track === 'function') {
          window.thriveStack.track([
            {
              event_name: 'signed_up',
              properties: {
                user_email: email,
                user_name: userName,
                utm_campaign: utms.utm_campaign,
                utm_medium: utms.utm_medium,
                utm_source: utms.utm_source,
                utm_term: utms.utm_term
              },
              user_id: userId,
              timestamp: new Date().toISOString()
            },
            {
              event_name: 'account_created',
              properties: {
                account_domain: accountDomain,
                account_id: accountId,
                account_name: accountName
              },
              user_id: userId,
              timestamp: new Date().toISOString(),
              context: {
                group_id: accountId
              }
            }
          ]);
        }
        alert('Signup successful! Please continue onboarding.');
        window.location.href = 'onboarding.html';
      });
    }
  </script>
</body>
</html>